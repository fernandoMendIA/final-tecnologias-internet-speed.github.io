<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
</head>
<body>
  <video id="video" src="carsVideo.mp4"  width="640" height="480" autoplay></video>
  <canvas id="canvas" width="640" height="480"></canvas>

  <script>
    async function setupCamera() {
      const video = document.getElementById('video');
      const stream = await navigator.mediaDevices.getUserMedia({ 'video': true });
      video.srcObject = stream;
      return new Promise((resolve) => {
        video.onloadedmetadata = () => {
          resolve(videnpmo);
        };
      });
    }

    async function loadModel() {
      const model = await tf.loadGraphModel('https://tfhub.dev/tensorflow/coco-ssd/1/default/1/model.json');
      mode.summary();
      return model;
    }

    async function detectFrame(model, video) {
      const canvas = document.getElementById('canvas');
      const context = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);

      const input = tf.browser.fromPixels(canvas);
      const expanded = input.expandDims();
      const prediction = await model.executeAsync(expanded);
      const boxes = prediction[0].arraySync();

      // Process detected boxes and draw them on the canvas
      for (const box of boxes) {
        const [y, x, height, width] = box;
        const startX = x * canvas.width;
        const startY = y * canvas.height;
        const endX = width * canvas.width;
        const endY = height * canvas.height;

        context.beginPath();
        context.rect(startX, startY, endX - startX, endY - startY);
        context.lineWidth = 2;
        context.strokeStyle = 'red';
        context.fillStyle = 'red';
        context.stroke();
        context.fillText('Car', startX, startY > 10 ? startY - 10 : 10);
      }

      tf.dispose([input, expanded, prediction]);

      requestAnimationFrame(() => {
        detectFrame(model, video);
      });
    }

    async function detect() {
      const model = await loadModel();
      const video = await setupCamera();
      video.play();
      detectFrame(model, video);
    }

    detect();
  </script>
</body>
</html>
